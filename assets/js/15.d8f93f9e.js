(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{419:function(t,s,a){"use strict";a.r(s);var n=a(2),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"docker部署kratos提示make-build-错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker部署kratos提示make-build-错误"}},[t._v("#")]),t._v(" docker部署kratos提示make build 错误")]),t._v(" "),s("p",[t._v("我正在尝试使用Docker去部署kratos的时候出现了以下问题：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ERROR "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("builder "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" RUN GOPROXY"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("goproxy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("make")]),t._v(" build                                                                                                                                                            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5s\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("builder "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" RUN GOPROXY"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("goproxy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("make")]),t._v(" build"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n#"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.554")]),t._v(" mkdir "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),t._v(" build "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ldflags "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-X main.Version=42ad07a"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("o "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n#"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.415")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("spf13"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cast@v1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),t._v(" requires\n#"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.415")]),t._v("       github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("frankban"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("quicktest@v1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14.3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" missing "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sum entry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" to add it"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n#"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.415")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),t._v(" mod download github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("frankban"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("quicktest\n#"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.422")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("make")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app_makefile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("72")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Error "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\nexecutor failed running "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c GOPROXY"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("goproxy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("make")]),t._v(" build"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" exit code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("make")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Error "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n")])])]),s("p",[t._v("这个错误提示很容易可以看出来，make build报错。再看下面的报错，显示有些依赖不存在，即使你使用go mod tidy也无济于事。")]),t._v(" "),s("p",[t._v("先前往make build去看看到底是怎么回事。。")]),t._v(" "),s("div",{staticClass:"language-makefile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-makefile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin-target builtin"}},[t._v(".PHONY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# build")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token target symbol"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\tmkdir -p bin/ && go build -ldflags "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-X main.Version=$(VERSION)"')]),t._v(" -o ./bin/ ./...\n")])])]),s("p",[t._v("可以看到，是不是没有什么问题")]),t._v(" "),s("p",[t._v("话不多说了，直接上解决办法！")]),t._v(" "),s("div",{staticClass:"language-makefile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-makefile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin-target builtin"}},[t._v(".PHONY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# build")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token target symbol"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\tmkdir -p bin/ && go build -mod"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mod -ldflags "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-X main.Version=$(VERSION)"')]),t._v(" -o ./bin/ ./...\n")])])]),s("p",[t._v("注意上面设置"),s("code",[t._v("-mod=mod")]),t._v("标志，实际上在做"),s("code",[t._v("go build")]),t._v("什么？")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("该"),s("code",[t._v("-mod")]),t._v("标志控制 go.mod 是否可以自动更新以及是否使用供应商目录。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("-mod=mod")]),t._v("告诉 go 命令忽略供应商目录并自动更新 go.mod，例如，当任何已知模块未提供导入的包时。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://go.dev/ref/mod#build-commands",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考这个"),s("OutboundLink")],1),t._v("。")])])]),t._v(" "),s("p",[t._v("总结：go1.16版本出现的问题，使用-mod=mod标志可以解决掉依赖不存在的问题")])])}),[],!1,null,null,null);s.default=r.exports}}]);